# 总线

在计算机系统中，功能部件之间必须互连。部件之间的互连方式有两种：

* 分散连接：各部件之间通过单独的连线互连
* 总线连接：将各个部件连接到一组公共信息传输线上

总线结构的主要优点：

* 灵活性：它的灵活性体现在新部件可以很容易地加到总线上，并且部件可以在使用相同总线的计算机系统之间互换。
* 成本低：因为一组单独的连线可被多个部件共享，所以总线的性价比高。

总线的主要缺点：它可能产生通信瓶颈。

现代计算机普遍使用总线互连结构。

## 总线的基本概念

计算机由CPU、主存模块和I/O模块组成。计算机的所有功能都是通过CPU周而复始地执行指令实现的。在指令执行过程中，CPU、主存和I/O模块之间要不断地交换数据（包括指令、中断向量等），因此可以说，**计算机所有功能的实现，归根结底是各种信息在计算机内部的各部件之间进行交换的过程**。

**要进行信息交换，必须在部件之间构筑通信线路**，通常把**连接各部件的通路的集合**称为**互连结构**。互连结构有**分散结构和总线结构**两种。

早期的计算机大多采用分散连接方式，相互通信的部件之间都有单独的连线，如果某个部件与其他所有部件都有信息交换，它的内部连线就非常复杂，而且成本高。此外，某一时刻它只能和其他部件中的一个交换信息，在交换信息过程中也必须停止本身的工作。这大大影响系统的工作效率。特别是随着计算机应用领域的不断扩大，I/O设备的种类和数量越来越多，用分散方式无法满足人们随时增减设备的需要，因此出现了总线连接方式。

总线是连接两个或多个功能部件的一组共享的信息传输线，它的主要特征是多个部件共享传输介质。一个部件发出的信号可以被连接到总线上的其他所有部件所接收。总线通常由许多传输线或通路构成，每条线可传输一位二进制信息，若干条线可同时传输多位二进制信息。



## 总线的特性

总线是一个**共享的传输介质**，必须规定其一些基本特性。

（1）物理特性。是指总线在机械物理连接上的特性。包括连线类型、数量、接插件的几何尺寸和形状，以及引脚线的排列等。
从连线的类型来看，总线可分为电缆式、主板式和底板式。电缆式总线通常采用扁平电缆连接电路板；主板式总线通常在印制电路板或卡上蚀刻出平行的金属线，这些金属线按照某种排列以一组连接点的方式提供插槽，系统的一些主要部件从这些槽中插入到系统总线；底板式总线通常是在机箱中设置插槽板，其他功能模块一般都做成一块卡，通过将卡插到槽内连接到系统中。

从连线的数量来看，总线一般分为串行总线和并行总线。在并行传输总线中，按数据线的宽度分8，16，32和64位总线等。总线的宽度对实现的成本、可靠性和数据传输速率的影响很大。一般串行总线用于长距离数据传送，并行总线用于短距离的高速数据传送。

（2）电气特性。是指总线的每一条信号线的信号传递方向、信号的有效电平范围。通常规定，由CPU发出的信号为输出信号，送入CPU的信号为输入信号。地址线一般为输出信号，数据线为双向信号，控制线的每一根都是单向的，有的为输出信号，有的为输入信号。

总线的电平表示方式有两种：单端方式和差分方式。单端电平方式采用一条信号线和一条公共接地线来传递信号，信号线中一般用高电平表示逻辑“1”，低电平表示逻辑“0”。差分电平方式采用一条信号线和一个参考电压比较来互补传输信号，因此一般采用负逻辑，即用高电平表示逻辑“0”，低电平表示逻辑“1”。

例如，串行总线接口标准RS-232C，其电气特性规定，低电平要低于-3V，表示逻辑“1”；高电平要高于+3V，表示逻辑“0”。

（3）功能特性。是指总线中每根传输线的功能。不同的控制线其功能不同，如地址线用来传输地址信息，数据线用来传输数据信息，控制线用来发出控制信息。

（4）时间特性。是指总线中任一根传输线在什么时间内有效，以及每根线产生的信号之间的时序关系。时间特性一般可用信号时序图来说明。

## 总线的分类

计算机系统中含有多种总线，在各个层次上提供部件之间连接和信息交换的通路。**根据所连接部件的不同**，总线通常被分成三种类型：**内部总线、系统总线和通信总线**。

（1）内部总线：指芯片内部连接各元件的总线。例如，CPU芯片内部，在各个寄存器、ALU、指令部件等各元件之间也有总线相连。

（2）系统总线：指**连接CPU、存储器和各种I/O模块等主要部件的总线**。**典型的系统总线有PCI总线、Multibus总线、VME总线**等。由于这些部件通常都制作在插件板卡上，所以连接这些部件的总线一般是主板式或底板式总线。

* **主板式总线是一种板级总线，主要连接主机系统印制电路板中的CPU和主存等部件**，因此也被称为“处理器—主存”总线，有的系统把它称为局部总线或处理器总线。
* **底板式总线通常用于连接系统中的各个功能模块**，实现系统中各个电路板的连接。

（3）通信总线：这类总线用于**主机和I/O设备之间**或**计算机系统之间**的通信。由于这类连接涉及许多方面，包括距离远近、速度快慢、工作方式等，差异很大，所以通信总线的种类很多。

### 系统总线的组成

一个**系统总线**通常由**一组控制线、一组数据线和一组地址线**构成。也有些总线没有单独的地址线，地址信息通过数据线来传送，这种情况称为数据线和地址线复用。

- 数据线用来承载源部件和目的部件之间传输的信息，这些信息可能是数据、命令或地址（如果数据线和地址线复用的话）。例如，如果一个磁盘想写一些数据到存储器，则数据线被用来传输主存的地址和实际从磁盘来的数据。数据线的条数被称为数据总线的宽度，它决定了每次能同时传输的信息的位数。因此数据总线的宽度是决定系统总体性能的关键因素。例如，如果数据总线的宽度为16位，而指令的操作数位数为32位，那么在取这个操作数时，必须访存两次。
- 地址线用来给出源数据或目的数据所在的主存单元或I/O端口的地址。例如，若要从主存单元读一个数据，那么CPU必须将该主存单元的地址送到地址线上。若要输出一个数据到外设，那么CPU也必须把该外设的地址（实际上是I/O端口的地址）送到地址线上。地址线是单向的，它的位数决定了可寻址的地址空间的大小。例如，若地址线有16位，不采用分时多次传送地址的话，则可访问的存储单元最多只能有216个。
- 控制线用来控制对数据线和地址线的访问和使用。因为数据线和地址线是被连接在其上的所有设备共享的，如何使各个部件在需要时使用总线，需靠控制线来协调。控制线用来传输定时信号和命令信息。

典型的控制信号包括：

●时钟（Clock）。用于总线同步。

●复位（Reset）。初始化所有设备。

●总线请求（Bus Request）。表明发出该请求信号的设备要使用总线。

●总线允许（Bus Grant）。表明接收到该允许信号的设备可以使用总线。

●中断请求（Interrupt Request）。表明某个中断正在请求。

●中断回答（Interrupt Answer）。表明某个中断请求已被接受。

●存储器读（Memory Read）。从指定的主存单元中读数据到数据总线上。

●存储器写（Memory Write）。将数据总线上的数据写到指定的主存单元中。

●I/O读（I/O Read）。从指定的I/O端口中读数据到数据总线上。

●I/O写（I/O Write）。将数据总线上的数据写到指定的I/O端口中。

●传输确认（Transfer ACK）。表示数据已被接收或已被送到总线上。



## 总线的数据传输方式

在计算机总线中，数据传输有两种基本方式：**串行传输和并行传输**。

1．串行传输

串行总线的数据**在数据线上按位进行传输**，因此**只需要一根数据线，线路的成本低，适合于远距离的数据传输**。在计算机中，普遍**使用串行通信总线连接慢速设备，如键盘、鼠标和终端设备**等。近年来也出现了一些中高速的串行总线，它可连接各种类型的外设，也可传送多媒体信息，如P1394串行总线。

在进行串行传输时，**按顺序传送一个数据的所有二进制位的脉冲信号，每次一位**，被传送的数据在**发送部件**中必须进行**并行数据到串行数据的转换**，这个过程称为**拆卸**；而在**接收部件**中则需要**将串行数据转换成并行数据**，这个过程称为**装配**。

串行总线是一种信息传输信道。在信息传输信道中，**携带数据信息的信号单元叫码元**，**每秒钟通过信道传输的码元数**称为**码元传输速率，简称波特率**。**波特率是衡量数据传送快慢**的重要指标，它反映了每秒钟传输的**数据位数**。**每秒钟通过信道传输的信息量**称为**位传输速率，简称比特率**。它反映了在传输介质上每秒钟传输的所有**信息位数**。它们的单位都是位/秒（b/s）。比特率可以大于或等于波特率。例如，一个串行总线每秒传送1200个数据位，即它的波特率是1200b/s；如果数据发送到传输介质时是一个脉冲发送一位数据，则它的比特率也是1200b/s；如果发送时是用n个脉冲调制一个数据位，那么比特率就是1200nb/s，它比波特率大。

串行传输方式可分为**同步方式和异步方式**两种。在异步传输方式中，每个字符要用一位起始位和若干停止位作为字符传输的开始和结束标志，需占用一定的时间。所以在进行数据块传送时，为了提高速度，一般把每个字符前后的附加位去掉，而将若干个字符作为一个数据块一起传送，在数据块的开始和结尾处用一个或若干个同步字符作为标志。这种方式称为同步串行传输方式。虽然同步方式比异步方式速度快，但它要求有时钟来实现发送端和接收端的同步，并且接口的硬件更复杂。有关串行通信的协议将在第9章介绍。

2．并行传输

并行总线的数据在数据线上同时有多位一起传送，每一位要有一根数据线，因此有多根数据线。并行传输比串行传输速度快得多，但需要更多的传输线。

衡量并行总线速度的指标是最大数据传输速率，即单位时间内在总线上传输的最大信息量。一般用每秒多少兆字节（MB/s）来表示。例如，若总线的工作频率为33MHz，总线宽度为32位，则它的最大数据传输速率为33×32/8=132MB/s（数据传输速率由总线工作频率而得，在频率中的1M=106。一般在通信传输中出现的M和k等单位是以10为基来衡量的）。

为了减少线路的数量，可以将并行方式和串行方式结合起来。当数据线不是很宽时，采用分多次传输的方法来实现，例如，在主存和Cache之间传输数据块时，常采用连续串行传输多个字的方法。这种总线传输方式称为突发式数据传送模式。
