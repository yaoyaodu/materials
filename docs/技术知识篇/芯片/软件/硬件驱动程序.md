# 驱动程序：硬件的灵魂

重点：

- 驱动程序即<font size=3 color="red">添加到操作系统中的一小块代码</font>，其中包含有关硬件设备的信息。
- 驱动程序是硬件厂商<font size=3 color="red">根据操作系统编写的配置文件</font>。
- 驱动程序是<font size=3 color="red">硬件的接口</font>，操作系统只有通过这个接口，才能控制硬件设备的工作。
- 驱动程序扮演沟通的角色，**把硬件的功能告诉电脑系统**，并且也**将系统的指令传达给硬件**，让它开始工作。
- 驱动程序本质上是**软件代码**，主要作用是计算机系统与硬件设备之间完成<font size=3 color="red">数据传送</font>的功能，只有借助驱动程序，两者才能通信并完成特定的功能。
- 像CPU、内存、主板、软驱、键盘、显示器等设备却并不需要安装驱动程序也可以正常工作，而**显卡、声卡、网卡等却一定要安装驱动程序**，否则便无法正常工作。

* A hardware driver is <font size=3 color="red">a small bit of computer code </font>packaged in a file that <font size=3 color="red">tells a computer system how to use a piece of hardware</font>. Every hardware component in a computer system requires a driver to function, whether it’s the printer, DVD player, hard disk, or graphics card. <font size=3 color="red">**Updating this code can also add new functionality to the component**</font>.

驱动程序一般指的是**设备驱动程序（**Device Driver**）**，是一种可以使计算机和设备进行相互通信的**特殊程序**。相当于**硬件的接口**，**操作系统只有通过这个接口，才能控制硬件设备的工作，**假如某设备的驱动程序未能正确安装，便不能正常工作。因此，驱动程序被比作“ 硬件的灵魂”、“硬件的主宰”、“硬件和系统之间的桥梁”等。

设备驱动程序用来**将硬件本身的功能告诉操作系统**，**完成硬件设备电子信号与操作系统及软件的高级编程语言之间的互相翻译**。设备驱动程序通常会占到70%以上份额的操作系统内核源码，且设备驱动程序的更新维护往往会牵涉到超过35%的源码修改，故而保持设备驱动程序与操作系统内核不断变化的其余部分的一致性是操作系统内核开发的一项难题。

当**操作系统**需要使用某个硬件时，比如让声卡播放音乐：

- **操作系统**会先**发送相应指令**到**声卡驱动程序**
- 声卡驱动程序接收到后，马上将其**翻译**成**声卡**才能听懂的**电子信号命令**，从而让声卡播放音乐。

驱动程序提供了硬件到操作系统的一个接口以及协调二者之间的关系，而因为驱动程序有如此重要的作用，所以人们都称**“驱动程序是硬件的灵魂”、“硬件的主宰”，同时驱动程序也被形象的称为“硬件和系统之间的桥梁”**。**驱动程序即添加到操作系统中的一小块代码，其中包含有关硬件设备的信息，计算机就可以与设备基于此信息进行通信。驱动程序是硬件厂商根据操作系统编写的配置文件**，可以说没有驱动程序，计算机中的硬件就无法工作。**操作系统不同，硬件的驱动程序也不同**，各个硬件厂商**为了保证硬件的兼容性及增强硬件的功能会不断地升级驱动程序**。**驱动程序是硬件的一部分**，当你安装新硬件时，驱动程序是一项不可或缺的重要元件。凡是安装一个原本不属于你电脑中的硬件设备时，系统就会要求你**安装驱动程序**，**将新的硬件与电脑系统连接起来**。**驱动程序扮演沟通的角色，把硬件的功能告诉电脑系统，并且也将系统的指令传达给硬件，让它开始工作。**

驱动程序本质上是**软件代码**，主要作用是计算机系统与硬件设备之间完成数据传送的功能，只有借助驱动程序，两者才能通信并完成特定的功能。

从理论上讲，所有的硬件设备都需要安装相应的驱动程序才能正常工作。但像CPU、内存、主板、软驱、键盘、显示器等设备却并不需要安装驱动程序也可以正常工作，而**显卡、声卡、网卡等却一定要安装驱动程序**，否则便无法正常工作。这是为什么呢？

这主要是由于这些硬件对于一台个人电脑来说是必需的，所以**早期的设计人员将这些硬件列为BIOS能直接支持的硬件**。换句话说，上述硬件安装后就**可以被BIOS和操作系统直接支持**，不再需要安装驱动程序。从这个角度来说，**BIOS也是一种驱动程序**。但是对于其他的硬件，例如：网卡，声卡，显卡等等 却必须要安装驱动程序，不然这些硬件就无法正常工作。

说明：

**BIOS**: 

* **Basic Input Output System（基本输入输出系统）**。BIOS是个人电脑**启动时加载的第一个软件**。
* 程序
* 主要功能：**为计算机提供最底层的、最直接的硬件设置和控制**。
* **系统硬件的变化是由BIOS隐藏，程序使用BIOS功能而不是直接控制硬件**。

其实，它是一组**固化到计算机内主板上一个ROM芯片上的程序**，它**保存着计算机最重要的基本输入输出的程序、开机后自检程序和系统自启动程序**，它可从CMOS中读写系统设置的具体信息。 **其主要功能是为计算机提供最底层的、最直接的硬件设置和控制。**此外，BIOS还向作业系统提供一些系统参数。**系统硬件的变化是由BIOS隐藏，程序使用BIOS功能而不是直接控制硬件**。现代作业系统会忽略**BIOS提供的抽象层**并直接控制硬件组件。

当今，此系统已成为一些病毒木马的目标。一旦此系统被破坏，其后果不堪设想。



## 底层驱动和抽象层驱动

驱动程序，简单地可以分为**底层驱动**和**抽象层驱动**。

- 底层驱动**直接操作寄存器**，开发者必须了解芯片的寄存器功能才能够编写和使用底层驱动，其特点是专一性、运行高效性。
- 抽象层驱动是**为了完成一个特定的任务，便于抽象层开发人员使用而封装、包含了一系列寄存器操作的函数**，即使不了解芯片的寄存器功能也可以使用，而且同一套抽象层驱动经过简单修改可以用于同架构相似的芯片，其特点是相对通用性、开发高效性。

一个驱动函数是底层驱动还是抽象层驱动，可以从它的功能来分析，举个例子：

- 向XXX寄存器写入00001111<-------这个是底层驱动
- 请求GPU在屏幕中央绘一个圆<------这个是抽象层驱动

