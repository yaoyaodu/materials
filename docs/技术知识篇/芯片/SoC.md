# SoC

来源：《系统芯片（SoC）设计方法与实践》读书笔记

“**从电路集成到系统集成**”是对集成电路产品发展过程的最好总结，即整个集成电路产品的发展经历了从传统的板上系统（System on Board）到片上系统（System on Chip）的过程。

SoC设计技术始于20世纪90年代中期，随着半导体工艺技术的发展，IC设计者能够将愈来愈复杂的功能集成到单硅片上，SoC正是在集成电路IC向集成系统IS转变的大方向下产生的。

由于SoC可以充分利用已有的设计积累，显著地提高了ASIC的设计能力，因此发展非常迅速，引起了工业界和学术界的关注。作为21世纪集成电路技术的主流，其为集成电路产业和集成电路应用技术提供了前所未有的广阔市场和难得的发展机遇。

## SoC定义

一般来说，是指**在单芯片上集成微电子应用产品所需的全部功能系统**；

采用**超深亚微米（Very Deep Subnicron, VDSM）**工艺技术和主要采用**第三方IP核复用**技术为支撑进行设计；

内置嵌入式存储器和可编程逻辑；

具备外部对芯片进行编程的功能；

具有完整系统所必备的全部或大部外设。

## SoC结构

SoC的结构如下图所示。

* 至少有一个CPU、DSP、或者MCU。
* 存储器
* 存储控制器：用于控制外部存储器。
* 片上连线：总线提供各IP间的数据通道。
* 专用加速器：如乘法器、视频编解码器等。
* I/O控制器：如PCI、PCI-X、以太网、USB以及ADC/DAC等。
* 外围设备：通用I/O接口、通用异步收发器、定时器、中断控制器等。

体现了数字与模拟共存，硬件、固件、软件共存，基带与射频共存，小信号与大功率共存。

同时在SoC中还应包括与硬件系统配套的实时操作系统（RTOS）。

<img src="https://i.loli.net/2021/09/05/jR4ZKpSCEFwDQq6.png" alt="image-20210905083012262" style="zoom: 50%;" />



## SoC分类

SoC按指令集来划分，主要有**X86系列、ARM系列、MIPS系列和类指令系列**，性能成本各有千秋。

## SoC涉及的关键技术

SoC设计方法学主要研究：

* 总线架构技术
* IP核可复用技术
* 可靠性设计技术
* 软硬件协同设计技术
* SoC设计验证技术
* 芯片综合/时序分析技术
* 可测性/可调试性设计技术
* 低功耗设计技术
* 新型电路实现技术
* 操作系统/嵌入式软件移植、开发

### 总线架构技术

总线结构及互连技术，直接影响芯片总体性能发挥。

目前SoC开发研制主要有基于平台（包括自主构建总体架构）、基于核、基于合成等方法，不断推出性能更好、扩展性更强的总线规范，如AXI总线（AMBA总线升级）、L*BUS总线（中科院计算所）等。

### IP核可复用技术

为了满足上市时间（Time to Market, TTM）的要求，对于日益复杂的SoC芯片设计，将越来越多的使用IP核（Intellectual Property Cores）。

IP核可复用的研究重点是开发适应多种总线接口的规范和可测试性一体化，以尽量少的外包和测试向量，达到复用的目的。

### 软硬件协同设计技术

改进软硬件协同说明、协同分析、协同设计、协同模拟和协同验证，可大大减少硬件设计风险和缩短嵌入式软件的开发调试时间。

同时在协同验证环境中能够及时发现软硬件中所存在的致命问题，避免在最后集成测试阶段重新进行软硬件的调整。

### 时序分析技术

由于SoC系统复杂度和规模愈来愈大，像**多时钟、多电压以及超深亚微米**等新课题不断出现，对SOC的综合性研究提出了更高的要求。

尤其对**时序预算如何分级、分解，关键路径的特殊约束**的研究，要求研究人员具有深厚的系统背景知识。

与此同时，静态时序分析（STA, Static Timing Analysis）日趋复杂、后端动态仿真效率低下，对总体设计人员提出了严峻的挑战。

### 验证技术

主要分**IP核验证**、**IP核与总线接口兼容性验证**和**系统级验证**等三个层次，包括设计概念验证、设计实现验证、设计性能验证、故障模拟、芯片测试等；从验证类型分，有兼容性测试、边角测试、随机测试、真实码测试、回归（Regression）测试和断言验证等。

**由于芯片愈来愈复杂，软件仿真开销大，硬件仿真验证成为一种重要的验证手段。验证工作约占整个设计工作的70%，如何提高验证覆盖率和验证效率是设计验证的永恒话题。**

### 可测性设计技术

主要研究解决**批生产可测性**问题和**在线可调试性**问题。实施技术包括**DFT、SCAN、BIST、JTAG/eJTAG**，要研究**基于各种IP核的SoC测试架构和测试向量有效传递性**，更重要的是要考虑**测试平行化**，降低芯片测试占用时间。此外要关注**在线调试**工作，方便用户开发和调试基于SOC的产品。

## SoC设计流程

SoC与传统的ASIC设计最大的不同在于以下两个方面：

* SoC设计更需要了解整个系统的应用，定义出合理的芯片架构，使得软硬件配合达到系统最佳工作状态。因而软硬件协同设计被越来越多地采用。
* SoC设计是以IP核复用为基础的。因此，基于IP模块的大规模集成电路设计是硬件实现的关键。

SoC设计是从整个系统的角度出发，把处理机制、模型算法、芯片结构、各层次电路直至器件的设计紧密结合起来。

SoC芯片设计是以IP核为基础，以分层次的硬件描述语言为系统功能和结构的主要描述手段，并借助EDA工具进行芯片设计的过程。



![image-20210904212309081](https://i.loli.net/2021/09/04/8cQJW7zTspxebOE.png)

<center><b>基于标准单元的SoC设计流程</b></center>

1. 硬件设计定义说明（Hardware Design Specification）

   描述芯片总体结构、规格参数、模块划分、使用的总线，以及各个模块的详细定义等。

2. 模块设计及IP复用（Module Design & IP Reuse）

   根据硬件设计所划分的功能模块，确定需要重新设计的部分及可复用的IP核。

3. 顶层模块集成（Top Level Integration）

   将各个不同的功能模块，包括新设计的与复用的整合在一起，形成一个完整的设计。通常采用HDL（硬件描述语言）对电路进行描述。其中考虑系统时钟/复位、I/O环等问题。

4. **前仿真（Pre-layout Simulation）（RTL级仿真或功能仿真）**

   通过**HDL仿真器**验证电路逻辑功能是否有效，及HDL描述是否符合设计所定义的功能期望。

   在前仿真时，通常与具体的电路实现无关，没有时序信息。

5. 逻辑综合（Logic Synthesis）

   使用EDA工具把由HDL设计的电路自动转换成特定工艺下的网表（Netlist），即从RTL级的HDL描述通过编译产生符合约束条件的**门级网表**。

6. 版图布局规划（Floorplan）

   确定设计中各个模块在版图上的位置：

   * I/O规划，确定I/O的位置，定义电源和接地口的位置。
   * 模块放置，定义各种物理的组、区域或模块，对这些大的宏单元进行放置。
   * 供电设计，设计整个版图的供电网络，基于电压降(IR Drop)和电迁移进行拓扑优化。

   挑战：**在保证布线能够走通且性能允许的前提下，如何最大限度地减少芯片面积**，是物理设计过程中需要设计者付出最大努力的地方之一。

7. 功耗分析（Power Analysis）

   在设计中的许多步骤都需要对芯片功耗进行分析，从而决定是否需要对设计进行改进。

   * 在版图布局规划后，需要对电源网络进行功耗分析（PNA, Power Network Analysis），确定电源引脚的位置和电源线宽度。
   * 在完成布局布线后，需要对整个版图的布局进行动态功耗分析和静态功耗分析。
   * 除了对版图进行功耗分析之外，还应通过仿真工具快速计算动态功耗，找出主要的功耗模块。这也是功耗分析的重要一步。

8. 单元布局和优化（Placement & Optimization）
   定义每个标准单元（Cell）的摆放位置并根据摆放的位置进行优化。现在，EDA工具广泛支持物理综合，即将布局和优化与逻辑综合统一起来，引入真实的连线信息，减少了时序收敛所需要的迭代次数。

9. 静态时序分析（STA, Static Timing Analysis）

   静态时序分析是一种穷尽分析方法。它通过**对提取的电路中所有路径上的延迟信息的分析**，计算出**信号在时序路径上的延迟**，找出**违背时序约束的错误**，如**建立时间（Setup Time）和保持时间（Hold Time）**是否满足要求。

   静态时序分析的方法不依赖于激励，而且可以穷尽所有路径，运行速度快，占用内存少。它完全克服了动态时序的缺陷，是SoC设计中重要的一个环节。

   在后端设计的很多步骤完成后都需要进行动态时序分析，如在逻辑综合完成之后，在布局优化之后，在布线完成后等。

10. 形式验证（Formal Verification）

    **逻辑功能上的等效性检查**。这种方法与动态仿真最大的不同点在于它不**需要输入测试向量**，而根据电路的结果判断两个设计在逻辑功能上是否相等。

    在整个设计流程中会多次引入形式验证用于比较RTL代码之间，门级网表与RTL代码之间，以及门级网表之间在修改之前与修改之后功能的一致性。

    **形式验证和动态时序分析一起，构成设计的静态验证**。

11. 可测性电路插入（DFT, Design for Test）

    通常，对于逻辑电路采用**扫描链**的可测试结构，对于芯片的输入/输出端口采用**边界扫描**的可测试结构。

    基本思想是通过插入扫描链，增加电路内部节点的可控性和可观测性，以达到提高测试效率的目的。

    一般在逻辑综合后进行扫描链的插入和优化。

12. 时钟树综合（Clock Tree Synthesis）

    SoC设计方法强调**同步电路**的设计，即**所有的寄存器或一组寄存器是由同一个时钟的同一个边沿驱动的**。

    **构造芯片内部全局或局部平衡的时钟链**过程，称为时钟树综合。

    分布在芯片内部**寄存器**与**时钟的驱动电路**构成了一种树状结构，这种结构称为时钟树。

    时钟树综合是在布线设计之前进行的。

13. 布线设计（Routing）

    这一阶段**完成所有节点的连接**。布线工具通常将布线分为两个阶段：

    * 全局布线
    * 详细布线

14. 寄生参数提取（Parasitic Extraction）

    寄生参数提取是**提取版图上内部互连所产生的寄生电阻和电容值**。

    这些信息通常会转换成标准延时的格式被反标回设计，用于做静态时序分析和后仿真。

15. 后仿真（Post-Layout Simulation）（门级仿真、时序仿真、带反标仿真）

    需要利用在布局布线后获得精确延迟参数和网表进行仿真，验证网表的功能和时序是否正确。

    后仿真一般使用标准延时（SDF，Standard Delay Format）文件来输入延时信息。

16. ECO修改（ECO, Engineering Change Order）

    工程修改命令。当在设计的最后阶段发现个别路径有时序问题或逻辑错误时，有必要对设计的部分进行小范围的修改和重新布线。

17. 物理验证（Physical Verification）

    物理验证是对版图的设计规则（DRC, Design Rule Check）及逻辑图网表和版图网表比较（LVS, Layout VS Schematic）。

    * DRC用以保证制造良品率。
    * LSV用于确认电路版图网表结构是否与其原始电路原理图（网表）一致。



## 术语说明

### 布局布线（Place and Route, P&R）

### 自动布局布线（Auto Place and Route, AP&R）

### 上市（Time to Market, TTM）

### 静态时序分析 （Static Timing Analysis, STA）

### 专用集成电路 （ASIC）

ASIC即专用集成电路，是指应特定用户要求和特定电子系统的需要而设计、制造的[集成电路](https://baike.baidu.com/item/集成电路/108211)。 目前用[CPLD](https://baike.baidu.com/item/CPLD/2527470)（[复杂可编程逻辑器件](https://baike.baidu.com/item/复杂可编程逻辑器件/12583489)）和 [FPGA](https://baike.baidu.com/item/FPGA/935826)（现场可编程逻辑门阵列）来进行ASIC设计是最为流行的方式之一，它们的共性是都具有用户现场可编程特性，都支持[边界扫描](https://baike.baidu.com/item/边界扫描/1150543)技术，但两者在集成度、速度以及编程方式上具有各自的特点。