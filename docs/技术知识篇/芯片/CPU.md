# CPU

关键概念：

- CPU的基本功能：取指、译码和执行。CPU依靠指令来计算和控制系统。
- CPU架构：CPU硬件电路的实现。**某款CPU的硬件设计其实就是针对某个指令集的一种硬件实现**。
- **指令集：机器代码，是可以直接在CPU上运行的代码。**
- **操作系统：应用程序**。**不论是操作系统还是普通的应用程序最终都得转化到二进制代码才能够被CPU所处理**。
- 计算机中约20%的指令承担了80%的工作。

## CPU结构

通常来讲，CPU的结构可以大致分为运算逻辑部件、寄存器部件和控制部件等。

- 运算逻辑部件：进行相关的逻辑运算，如：可以执行移位操作以及逻辑操作，除此之外还可以执行定点或浮点算术运算操作以及地址运算和转换等命令，是一种多功能的运算单元。
- **寄存器**部件：**用来暂存指令、数据和地址的**高速独立的存储单元。CPU的运算离不开多个寄存器。
  - 数据寄存器：在过去，计算机只有几个数据寄存器用来存储输入数据和运算结果。现在，由于越来越多的复杂运算改由硬件设备实现，而不是软件，所以计算机在CPU中使用几十个寄存器来提高运算速度，并且需要一些寄存器来保存这些运算的中间结果。
  - 指令寄存器：**CPU的主要职责是：从内存中逐条地取出指令，并将取出的指令存储在指令寄存器中，解释并执行指令。**
  - 程序寄存器：CPU中另一个通用寄存器是程序计数器。**程序计数器中保存着当前正在执行的指令。**当前的指令执行完后，计数器将自动加1，指向下一条指令的内存地址。
- 控制部件：主要用来对指令进行分析并且能够发出相应的控制信号。

对于中央处理器来说，可将其看作一个规模较大的集成电路，其主要任务是加工和处理各种数据。中央处理器中的核心部分就是控制器、运算器，其对提高计算机的整体功能起着重要作用，能够实现寄存控制、逻辑运算、信号收发等多项功能的扩散，为提升计算机的性能奠定良好基础。 



## CPU与指令集的关系

**CPU依靠指令来计算和控制系统，**每款CPU在设计时就规定了一些列**与其硬件电路相配合的指令系统**，或者说**某款CPU的硬件设计其实就是针对某个指令集的一种硬件实现**。**指令集**也就是所谓的**目标代码（或称为机器代码，是可以直接在CPU上运行的代码）**可以看作是要求CPU对外提供的功能，某款CPU的设计肯定是朝着某个指令集来的。所以，**不同的CPU架构，也表示它的指令集要么较之前的指令集有所拓展或者就是实现了一种全新的指令集。指令集中的一条指令，就是让CPU完成一系列的动作，而该动作的完成则表明了某种运算的完成**。一个功能可能需要一条或几条指令来实现。比如汇编的MOV或者LD语句就可能对应着几条CPU指令。

下面介绍几种常见的CPU架构与指令集的对应关系（**所谓架构是指硬件电路的实现**）：

- **Intel X86架构CPU**可能实现了多个指令集x86，x86-64，MMX，SSE，SSE2，SSE3，SSSE3 ，而这些指令集中的指令让CPU完成的动作都比较复杂，所以也称为**CISC**。
- AMD amd64架构的CPU兼容了x86指令集还拓增了3D-Now!指令集，用于加强对3D显示的支持。

- ARM ARMv1~ARMv7架构的CPU实现了Thumb指令集和ARM指令集。这些指令集中的一条指令让CPU完成的动作都比较简单，所以也称为RISC指令集。


## 指令集与操作系统的关系

这里要重新提及一下之前讲到的两个概念：**指令集——就是机器代码；操作系统——就是应用程序**。

首先我们要知道计算机之父冯-诺伊曼说计算机只能运行在二进制上。所以**不论是操作系统还是普通的应用程序最终都得转化到二进制代码才能够被CPU所处理**。而用高级语言编写的普通应用程序都必须经过**编译器**编译后成为**二进制代码（指令）**才能运行。而不同的CPU所实现的指令集不同，所以不同的指令集对应的编译器也不尽相同，编译器不同，相同的高级语言程序经过编译后所得到的二进制代码也不同。这就引出了“移植”和“跨平台”两个概念。

OK，重新捋一下：**CPU架构-指令集-编译器-程序** 环环相扣，紧密联系。所以你就会听到说**Windows操作系统只能够运行在X86架构的CPU上，**不能运行在Power 或 ARM 上，因为指令集不同，又所以就有了“Wintel”联盟。所以你也可以看到**有的编译器是有硬件厂家提供的，比如Intel就提供C和C++的编译器，这样编译出来的程序就能更好的利用硬件的性能。**

那为什么又会听到linux可以运行在不同架构的CPU上呢？那是因为linux是开源的，因此就可以将它移植到不同的CPU平台上，然后在用相应的编译器编译，就得到了可以在该CPU上运行的二进制代码了。而Windows是封闭的，得不到源代码，而MS自己又没有移植到别的CPU平台上的打算，所以当然就只能在X86上运行了。（BTW，X86也是性能最好的CPU之一，而Windows对性能要求较高，所以MS当然也就不愿意移植了）

## CISC VS RISC

CPU内部已经含有一些小指令集，我们所使用的软件都要经过CPU内部的微指令集来完成才行。这些指令集的设计主要分为两种设计理念，分别是精简指令集（RISC）和复杂指令集(CISC)。

RISC（reduced instruction set computer，精简指令集计算机）是一种执行较少类型计算机指令的微处理器。这样一来，它能够以更快的速度执行操作。因为计算机执行每个指令类型都需要额外的晶体管和电路元件，计算机指令集越大就会使微处理器更复杂，执行操作也会更慢。

纽约约克镇IBM研究中心的John Cocke证明，**计算机中约20%的指令承担了80%的工作**，他于1974年提出了RISC的概念。

CISC (complex instruction set computer,复杂指令集计算机）除了RISC，任何全指令集计算机都使用的是复杂指令集计算（CISC）。

目前常见使用RISC的处理器包括DEC Alpha、ARC、ARM、MIPS、PowerPC、SPARC和SuperH等。

常见使用CISC的处理器主要有AMD、Intel、VIA等IA-32、X86架构的CPU产品。目前主流的CPU都是双核以上的架构了。原本的单核CPU仅有一个运算单元，所谓的**多核则是在一个CPU封装当中嵌入了两个以上的运算内核**，简单地说，就是一个实际的CPU外壳中含有两个以上的CPU单元。

RISC和CISC的区别：

**（1） 指令系统：**

- RISC 设计者把主要精力放在那些**经常使用的指令**上，尽量使它们具有**简单高效**的特色。对不常用的功能，常通过组合指令来完成。因此，在RISC 机器上实现特殊功能时，效率可能较低。但可以利用流水技术和超标量技术加以改进和弥补。
- CISC 计算机的指令系统比较丰富，**有专用指令来完成特定的功能**。因此，处理特殊任务效率较高。　　

**（2） 存储器操作：**

- RISC 对存储器操作有限制，使控制简单化。
- CISC 机器的存储器操作指令多，操作直接。　　

**（3） 程序：**

- RISC **汇编语言程序**一般需要较大的内存空间，实现特殊功能时程序复杂，不易设计；
- CISC 汇编语言程序编程相对简单，科学计算及复杂操作的程序设计相对容易，效率较高。　 

（4） 中断：

- RISC 机器在一条指令执行的适当地方可以响应中断；
- CISC 机器是在一条指令执行结束后响应中断。　　

**（5） CPU芯片电路：**

- RISC CPU 包含有较少的单元电路，因而面积小、功耗低；
- CISC CPU 包含有丰富的电路单元，因而功能强、面积大、功耗大。　　

**（6） 设计周期：**

- RISC 微处理器结构简单，布局紧凑，设计周期短，且易于采用最新技术；
- CISC 微处理器结构复杂，设计周期长。　　

**（7） 用户使用：**

- RISC 微处理器结构简单，指令规整，性能容易把握，易学易用；
- CISC微处理器结构复杂，功能强大，实现特殊功能容易。　　

**（8） 应用范围：**

- RISC 指令系统的确定与特定的应用领域有关，故RISC 机器更适合于专用机；
- CISC 机器则更适合于通用机。



## CPU频率

CPU内部含有微指令集，不同的微指令集会导致CPU工作效率的优劣。除此之外，与CPU性能相关的还有CPU的频率。

频率就是CPU每秒钟可以进行的工作次数。频率越高表示CPU单位时间内可以做更多的事情。

例如CPU的频率为3.0GHz, 表示这个CPI在一秒内可以进行3.0×10<sup>9</sup>次工作。
