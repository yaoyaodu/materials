# 虚拟化

核心概念：

* **虚拟化技术**已经成为一种被大家广泛认可的**服务器资源共享方式**。
* 这些**客体操作系统**，共同**分享虚拟化后的硬件资源**。

* 以**kubernetes**为代表的**容器集群管理系统**。
* MIG 打破了 GPU 虚拟化中资源分配的瓶颈。
* **Hypervisor**：也可叫做**VMM（ virtual machine monitor ）**，即**虚拟机监视器**。
* In computing, a hypervisor, also called virtual machine monitor (VMM), is **a piece of software/hardware platform-virtualization software** that **allows multiple operating systems to run on a host computer concurrently.**
* Hypervisors是一种**在虚拟环境中的“元”操作系统**。他们**可以访问服务器上包括磁盘和内存在内的所有物理设备**。
* Hypervisors不但**协调着这些硬件资源的访问**，也同时**在各个虚拟机之间施加防护**。当服务器启动并执Hypervisor时，它会**加载所有虚拟机客户端的操作系统**同时会**分配给每一台虚拟机适量的内存、CPU、网络和磁盘**。

* Docker是一个**开源的应用容器引擎**，开发者可以打包他们的**应用及依赖**到一个**可移植的容器**中，发布到流行的Linux机器上，也可实现**虚拟化**。

  * **传统的虚拟技术**：在**将物理硬件虚拟成多套硬件后**，需要**在每套硬件上都部署一个操作系统**，接着**在这些操作系统上运行相应的应用程序**。

  * 而Docker容器内的应用程序进程**直接运行在宿主机(真实物理机)的内核上**，**Docker引擎**将一些各自独立的应用程序和它们各自的依赖打包，**相互独立直接运行于未经虚拟化的宿主机硬件上**，同时**各个容器也没有自己的内核**，显然**比传统虚拟机更轻便**。



虚拟化技术

指通过虚拟化技术将一台计算机虚拟为多台逻辑计算机。**在一台计算机上同时运行多个逻辑计算机，每个逻辑计算机可运行不同的操作系统**，并且**应用程序都可以在相互独立的空间内运行而互不影响**，从而显著提高计算机的工作效率。

## Hypervisor

概念

Hypervisor——一种**运行在基础物理服务器和操作系统之间的中间软件层**，可**允许多个操作系统和应用共享硬件**。也可叫做VMM（ virtual machine monitor ），即**虚拟机监视器**。

Hypervisors是一种**在虚拟环境中的“元”操作系统**。他们**可以访问服务器上包括磁盘和内存在内的所有物理设备**。

Hypervisors不但**协调着这些硬件资源的访问**，也同时**在各个虚拟机之间施加防护**。当服务器启动并执Hypervisor时，它会**加载所有虚拟机客户端的操作系统**同时会**分配给每一台虚拟机适量的内存，CPU，网络和磁盘**。

In computing, a hypervisor, also called virtual machine monitor (VMM), is **a piece of software/hardware platform-virtualization software** that **allows multiple operating systems to run on a host computer concurrently.**

作用

Hypervisor是所有虚拟化技术的核心。 非中断地支持多工作负载迁移的能力是Hypervisor的基本功能。

多Hypervisor 

**服务器虚拟化需要评估、选择和部署hypervisor，**组织通常会选择一种主流的hypervisor：VMware的ESXi、微软的Hyper-V或者思杰的XenServer。

然而，对很多组织来说，单独的hypervisor已经不能满足所有的虚拟化需求。这时候可以选择采用第二类hypervisor产品。随着服务器虚拟化技术的成熟，多hypervisor环境已经变得常见。但是，采用第二类虚拟化平台时，必须要仔细考虑其成本、部署范围和总开销。 

Hypervisor，又称**虚拟机监视器**（英语：**virtual machine monitor**，缩写为 **VMM**），是用来建立与执行虚拟机器的软件、固件或硬件。
被Hypervisor用来执行一个或多个虚拟机器的电脑称为**主体机器（host machine）**，这些虚拟机器则称为**客体机器（guest machine）**。hypervisor提供虚拟的作业平台来执行**客体操作系统（guest operating systems）**，负责管理其他客体操作系统的执行阶段；这些**客体操作系统**，共同**分享虚拟化后的硬件资源**。

super、hyper是同意词，意思都是**超级**，感觉hyper比super还要高级。
hypertext，超文本。    supervisor，n.监督者。
hypervisor，n.超级监督者，引申为**超级管理程序、超多功能管理器、虚拟机管理器、VMM**



## 容器技术：container（一种新型的虚拟化技术）

容器技术：有效的**将单个操作系统的资源划分到孤立的组中**，以便更好的**在孤立的组之间平衡有冲突的资源使用需求**，这种技术就是容器技术。

**虚拟化技术**已经成为一种被大家广泛认可的**服务器资源共享方式**，它可以在**按需构建操作系统实例**的过程当中**为系统管理员提供极大的灵活性**。

由于**hypervisor虚拟化技术仍然存在一些性能和资源使用效率方面的问题**，因此出现了一种称为**容器（Container）的新型虚拟化技术**来帮助解决这些问题。



## Docker

Docker是一个**开源的应用容器引擎**，开发者可以打包他们的**应用及依赖**到一个**可移植的容器**中，发布到流行的Linux机器上，也可实现**虚拟化**。

从虚拟化角度：

右图是**Docker容器**与**传统虚拟化**方式的不同之处。

* **传统的虚拟技术**：在**将物理硬件虚拟成多套硬件后**，需要**在每套硬件上都部署一个操作系统**，接着**在这些操作系统上运行相应的应用程序**。

* 而Docker容器内的应用程序进程**直接运行在宿主机(真实物理机)的内核上**，**Docker引擎**将一些各自独立的应用程序和它们各自的依赖打包，**相互独立直接运行于未经虚拟化的宿主机硬件上**，同时**各个容器也没有自己的内核**，显然**比传统虚拟机更轻便**。

每个集群有多个节点，每个节点可创建多个容器，**kuberbete**就是**管理这些应用程序所在的小运行环境**（container）而生。

从部署角度：

图1是从虚拟化角度，说明了**为应用提供必要的运行环境所需要做的虚拟化操作**（即：**传统：虚拟出的虚拟机装操作系统**、Docker：**容器引擎管理下的容器**）。

而图2是在这些具体运行环境上进行真实应用部署时的情况。

传统方式是将所有应用直接部署在同一个物理机器节点上，这样每个App的依赖都是完全相同的，无法做到App之间隔离，当然，为了隔离，我们也可以通过创建虚拟机的方式来将App部署到其中（就像图1上半部分那样），但这样太过繁重，故**比虚拟机更轻便的Docker技术出现**，现在我们**通过部署Container容器的技术来部署应用**，**全部Container运行在容器引擎上即可**。既然嫌弃虚拟机繁重，想用Docker，那好，你用吧，怎么用呢？手动一个一个创建？当然不，故**kubernetes**技术便出现了，**以kubernetes为代表的容器集群管理系统**，这时候就该上场表演了。

我们**用kubernetes去管理Docker集群**，即**可以将Docker看成Kubernetes内部使用的低级别组件**。另外，kubernetes不仅仅支持Docker，还支持**Rocket，这是另一种容器技术**。

**VDI (Virtual Desktop Infrastructure)** （**虚拟机的一种**）

VDI is **the hosting of desktop environments on a central server**. It is a form of **desktop virtualization**, as the specific desktop images run within **virtual machines (VMs)** and are delivered to end clients over a network. Those endpoints may be PCs or other devices, like tablets or thin client terminals.



## 多实例GPU（MIG（multi-Instance GPU）（虚拟化））

而随着 GPU 的应用越来越广泛，应用场景愈发多元，对 GPU 的利用率的要求也不断提升，**传统虚拟化方法之下，GPU 计算资源的浪费对计算效率造成的的影响日渐凸显**，**提升算力以外，破解资源浪费难题也已迫在眉睫**。
MIG（multi-Instance GPU）就这样应运而生了。

2020 年 5 月 14 日，NVIDIA 发布了最新的 GPU 架构 -- 安培。全新的安培架构提供了一系列新性能，而其中最值得一提的无疑是 MIG（多实例 GPU）。**MIG 打破了 GPU 虚拟化中资源分配的瓶颈**，能够将基于安培架构的 GPU 服务器 A100 切分成 7 个 GPU 实例，并且可以使**每一个 GPU 实例都能够拥有各自的 SMs 和内存系统，让每个实例之间的内存空间访问互不干扰，保障每一个使用者的工作时延和吞吐量都是可预期的**。



## 单根I/O虚拟化 

## SR-IOV (Single Root I/O Virtualization)

Intel提出来SR-IOV。SR-IOV最初应用在网卡上。简单的说，就是一个物理网卡可以虚拟出来多个轻量化的PCI-e物理设备，从而可以分配给虚拟机使用。
SR-IOV makes virtualization in **PCIe**, not related to chip inside.
