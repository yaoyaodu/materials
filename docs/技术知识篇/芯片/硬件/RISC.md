# SOC中的嵌入式精简指令集处理器RISC

## 1 概述

在SOC中，往往将**微处理器作为“核（Core）”**，然后利用EDA工具，将外围电路与其组合在一起，构成一个系统，微处理器的这种应用方式称为嵌入式（或嵌埋式）微处理器。

目前，嵌入式微处理器普遍采用RISC技术，而不采用CISC处理器。这是由于CISC指令格式复杂，难以实现流水线操作，此外，CISC中大量复杂指令的使用频度不高，但其微码（微指令）占用了大量芯片面积。因此，**在SOC中都采用RISC处理器或RISC处理器和专用数字信号处理部件相结合的方法，来获得高的运算效率和较小的芯片面积。**

对于一个微处理器的性能，可以由下式表示：

<img src="https://i.loli.net/2021/09/14/4ATJoidfm5aL2zY.png" alt="image-20210914111748774" style="zoom:50%;" />

式中：

* P：微处理器的性能
* I：程序的指令集合
* C：每条指令的平均执行周期数
* f：微处理器工作频率。

由上式可知，提高微处理器的性能有三个途径：

* 提高工作频率f，这取决于工艺水平和电路设计水平的提高。

* 减少程序指令集合，这取决于优化编译器的改进。

* 对于结构设计来说，最大的改进潜力在于**减少平均指令执行周期数C**，其方法是**采用流水线结构和并行处理**。

  **并行处理只对程序中可以并行执行的部分起作用。而其他部分只有采用流水线操作的方法达到指令级的并行操作。**为了采用流水线结构，**指令结构应简单，格式固定，长度定长**。

  RISC处理器正是为了适应这样的要求发展起来的。在同样的条件下，RISC处理器的性能要比CISC处理器的性能提高3～4倍。

## 2 RISC的定义与特点

RISC处理器所具有的指令系统应**有利于流水线处理器的高效执行**，并**有利于优化编译器的代码生成**。

上述定义虽然没有规定RISC的任何特征，然而确定了RISC的基本准则，所有与RISC处理器有关的特征都是从这个基本准则派生出来的。概括地说，为了使流水线处理器高效的执行，RISC处理器应具有如下特点：

1．格式简单、长度固定的指令系统

RISC处理器的指令格式简单，**寻址方式不超过三种**。指令长度固定，通用RISC微处理器的指令长度为32位。

Microchip开发生产的PIC16/17系列单片机的指令仅12～16位。由此简化了逻辑，**缩短了译码时间，有利于流水线操作。**

2．短周期时间

为了指令的快速执行，必须选择快速译码和减少寄存器存取时间。

3．单周期执行指令

由于RISC处理器的**指令经过精选，所有指令长度相同**，大多数指令可以在一个机器周期内执行完毕。事实上，大多数RISC处理器在没有增加并行处理技术时，平均每条指令的执行时间为1.25～2个机器周期。在相同工艺技术条件下，CISC处理器平均执行每条指令需要5～8个机器周期。

4．Load（取）/Store（存）结构

**每当一条指令需要访问主存信息时，处理器的执行速度将会降低**。RISC的**Load/Store指令只有在访问内存时才使用。所有其他的指令都是在寄存器内对数据进行运算**。

一条取数指令（Load）**从内存将数据取出放到寄存器中**，在那里可以对数据进行快速处理，并将数据暂存在寄存器中，以便将来再用。在适当的时候，**由Store指令将这个数据送回到内存中**。

**RISC设计中，处理器含有大量寄存器，允许数据在寄存器中保留较长的时间，每当数据再被使用时，不必再次访问内存。由此减少对内存访问的时间。**

5．硬连线控制
采用少量简单、固定的硬连线控制逻辑代替微码以实现指令的快速运算。

6．大寄存器堆（Register file）

在大量应用程序中，计算机所做的工作**约70%为操作数访问，30%为操作**。**对于每一个操作，都需要一个或二个源操作数，而操作结果要放入另一个操作数所在的单元中。这表明，对操作数的访问是至关重要的。为此，必须选用最快的存储器件—寄存器。**

相对于主存中的存储单元，寄存器的个数较少。大量CISC处理器上运行的应用程序的统计分析表明，当寄存器由16个增加到32个后，程序运行产生明显的性能增益。然而，当寄存器增加到64个时，就没有明显的增益，过多的寄存器会增加芯片面积和增加指令中寄存器地址编码的长度，延长访问时间。**故现代RISC处理器的每个寄存器堆一般都包含32个寄存器。**

这些**寄存器和运算部件制作在同一个芯片内**，寄存器地址在指令中给出，从而加快了寄存器寻址的速度。**RISC处理器**充分利用寄存器的快速特点，形成了**以寄存器为中心的结构**。

现代处理器中，一般**将一组寄存器统一编址，作为暂存器、累加器、计数器及主存单元的指针等**，这种寄存器组称为**通用寄存器**。**具有公用读写端口的一组通用寄存器称为寄存器堆**（Register File）。

RISC处理器的寄存堆一般具有两个读端口，一个写端口，以适应三操作数的指令格式。**寄存器的宽度等于机器的字长。**

7．哈佛（Harvard）总线结构

总线是计算机内信息流通的主要渠道，也是制约计算机工作速度的重要因素。**现代处理器内都采用哈佛总线结构，即程序存储器总线和数据存储器总线相互独立**。采用指令和数据高速缓存（Cache），以提高数据带宽，增加数据传送吞吐量。

8．高效的流水线操作

流水线操作可以实现**指令级的并行处理，有效提高处理器的性能**。RISC指令系统特别有利用高效的流水线操作。

9．延时转移

这是处理指令转移的一种方法。在这个方法中，当遇到条件转移时（无法预测转移结果），将转移指令与其后的指令交换位置，先执行后条指令，再执行转移指令，以利指令的流水操作，确保一个机器周期执行一条指令。这也是RISC设计技术的一个重要特点。

10．重迭寄存器窗口技术

在RISC处理器中，寄存器堆采用**窗口式结构**，这种结构特别适合于**过程调用，有利于参数传递**。其结构如图所示，图中W表示窗口，序号代表第n个窗口，由当前**工作空间指针CWP（Current Workspace Pointer）**指示。

**整个寄存器堆分成若干个窗口，每个窗口分成三个部分，即输入、局部及输出三个部分。**第一个窗口的输出部分就是第二个窗口的输入部分，就是说**两个窗口共用输入输出部分**。这种结构称为窗口重迭技术。

<img src="https://i.loli.net/2021/09/14/BhgOZTiLqmP45tE.png" alt="image-20210914113528287" style="zoom:50%;" />

图 寄存器窗口结构



如果过程1使用第一个窗口W1，则当过程1调用过程2时，工作空间指针CWP自动加1指向W2，这时过程2在W2中得到过程1传递给过程2的参数（变元），同时又获得一组局部寄存器和一组输出寄存器。这一组输出寄存器又与W3的输入寄存器重迭，成为过程2调用其他过程的参数传递渠道。这样，**两个过程之间的参数传递依靠硬件自动完成，省略了大量内存访问时间**，大大加快了过程的调用和返回，非常适合面向对象的高级语言，如C++等。

11．优化编译器

将高级语言表示的算法转换成等价的面向机器的目标语言的过程称为**编译**。具有编译功能的程序称为编译程序或编译器。如果编译器在产生目标代码的过程中，能够对目标码进行优化，则这种具有优化功能的编译器称为优化编译器。

20世纪70年代中期，Stanford大学在研制MIPS（Microprocessor without Intel locked Pipeline Stages）处理器时，即开始从事对MIPS RISC编译器的优化编译技术的研究，以解决如何有效地利用RISC的硬件资源（如并行处理技术、寄存器堆、高速缓存等），充分挖掘程序的并行性；更合理地利用RISC体系结构所定义的指令系统，减少执行指令的数量；最大限度地利用通用寄存器，减少高速缓存和主存访问等。MIPS编译器的优化技术取得实质性的进展，并逐步成为世界上最先进的优化编译器。

**RISC处理器的上述特点并不排斥执行复杂功能的指令（例如浮点运算），然而只有那些对系统功能产生净增益的功能用硬件实现（从而包含这类指令），其余部分都用软件实现。**所谓“精简”，并不是简单地减少，而是保留经验证的能提高计算机性能的指令。RISC设计的基本目的在于使计算机结构更加简单、合理、有效。

## 3 RISC的指令特点

RISC处理器的指令长度采用定长度形式，一般为32位。指令数较少，例如SPARC的指令是64条，一般仅数十条指令，Microchip的单片机PIC17x系列为58条指令，而PIC16x系列仅34条指令。

指令类型包括**取数/存储指令、运算指令、跳转和转移指令、特殊指令**。有的处理器还有**协处理器指令**。

* 取数/存储指令用于**在存储器和通用寄存器之间传送数据，它们都是I类指令**，因为这类指令支持的唯一寻址方式是基址寄存器加上16位带符号立即数偏移量。

* 运算指令**对寄存器中的值执行算术运算、逻辑运算和移位操作等功能**，包括R类型（两个操作数都是寄存器）和I类型（有一个操作数是16位的立即数）二种格式。

* 跳转和转移指令用于**改变程序的控制流向**，J型格式的跳转指令总是跳转到绝对值的26位地址，而R型格式的跳转指令则跳转到寄存器地址（用于返回和调度）。转移指令由相对于程序计数器的16位带符号立即数作偏移量（I类型）。

* 特殊指令执行各种专门任务，包括在专用寄存器和通用寄存器之间的数据传送、自陷和断点。特殊指令都是R型的。

* 协处理器指令执行协处理器中的操作。协处理器的取数和存储指令都是I类型的，而协处理器的运算指令有其独立的格式。

RISC处理器指令的主要特点如下：

（1）RISC处理器的指令均为**单字指令，字长固定，一般为32位。**
（2）指令数量少，一般仅数十条指令。
（3）指令格式简单。MIPS的指令格式仅三种，如图所示。

<img src="https://i.loli.net/2021/09/14/vJoFgAiw1aLs3pE.png" alt="image-20210914134556457" style="zoom:50%;" />
图 MIPS RISC处理器的指令格式

图中：
op: 6位**操作码**；
rs：源寄存器地址编码，5bit；
rt：目的寄存器地址编码或转移条件，5bit；
immediate: 16位立即数，转移位移量或地址位移量；
target: 26位跳转目标地址；
rd: 5位目的寄存器说明符；
sa: 5位移位量；
funct: 6位功能字段。

由于**RISC体系结构是面向寄存器的**，因此，和CISC体系结构相比，**RISC的寻址方式十分简单**。

所谓**寻址方式**就是**确定一个操作数的方法**。

RISC指令中，对于**运算类指令**，寻址方式有两种：

1．立即寻址

将指令中的一个字段符号扩展成机器字长，作为指令的操作数使用。

2．**寄存器寻址**

**指令给出寄存器编号，该寄存器的内容即实际的操作数。这是一种最普遍采用的寻址方式。**



对于**存储器访问指令**，其寻址方式主要有三种：

1．寄存器间址

指令给出寄存器编号，该寄存器的内容是实际操作数地址。

2．变址寻址

有的RISC处理器可给出两个寄存器，将这两个寄存器的内容相加，其和作为操作数地址。此时，一个寄存器相当于基址寄存器，另一个相当于变址寄存器。

3．位移寻址
指令给出一个寄存器编号，并给出一个位移字段，将这个字段符号扩展成机器字长，再与寄存器的内容相加，其和作为操作数地址。

**对于控制类指令，只形成地址，而不取操作数**。地址形成方式有如下几种：

1．绝对方式
转移指令中给出地址的全部或部分，对于后一种方式，地址中其余各位由指定的寄存器或PC提供。

2．寄存器间接方式
指令中给出一个寄存器，该寄存器中包含有转移目标地址。

3．PC相对方式
转移指令提供一个位移字段，对该字段符进行扩展后与PC相加，其和作为转移目标地址。

4．变址方式

由体系结构规定的某寄存器提供基址，指令中给出的寄存器的内容与基地址相加作为转移目标地址。

## 4 RISC的并行处理技术

在计算机中，**采用并行处理技术，实现指令级的并行运算，是提高计算机性能的重要途径**。**RISC体系结构就是为了有效地发挥并行处理技术**。目前在计算机中采用的并行处理技术主要有**流水线操作、超标量处理技术**和**超长指令字VLIW**（Very Long Instruction Word, VLIW）处理技术。

### 1．流水线处理技术

计算机中的流水线处理技术吸取了工业生产中流水作业的思想。工业生产中的流水线作业，是一种组织生产的方式，这种方式将每一个生产过程划分为若干个工序，按照一定的顺序和速度，使生产过程象流水一样经过每个工序，使每个工序都充分忙碌起来。

在计算机中所执行的**指令**，也可以划分成**若干个顺序的操作**。通常，**一条指令的执行过程**至少可以划分为**取指、译码、执行、写结果等几个操作**，**每个操作**需要**至少一个机器周期**（也有的操作可以少于一个机器周期，如译码）。在普通计算机中，当指令在执行某个操作时，除了与之相关的执行部件外，其他部件处于空闲状态。**为了充分发挥硬件资源的作用，提高计算机的工作速度，可以同时处理多条指令**。

如下图，当第一条指令取出后，在第二个机器周期对第一条指令进行译码的同时，取第二条指令。到了第三个机器周期，第一条指令被执行，第二条指令被译码，第三条指令被取指。第四个机器周期后，始终有四条指令被同时处理，一条指令在写结果，一条指令在执行，一条指令在译码，一条指令被取指。如果每个微操作为一个机器周期，则流水操作的结果使得每个机器周期可执行一条指令，比不采用流水作业的计算机速度快4倍以上。

在这种结构的计算机中，**对于每一个处理部件来说，每条指令中的同类操作像流水一样连续地被加工处理**。而**对于每条指令来说，则像流水一样一次通过不同的处理部件。**流水线处理技术最早于20世纪60年代在IBM7030计算机上得到应用。

![image-20210914135317324](https://i.loli.net/2021/09/14/EPomwzcRtJSpWUq.png)

图 四级流水线操作

流水线操作的处理器**硬件相应比较复杂**，同时，**对指令系统的设计有一定的要求**，如指令格式应简单，指令长度应相同，指令的执行时间应一致等。

提高流水线处理效率的一个方法是**增加流水线的级数（即流水线的深度）**，以使在全流水方式下，每个机器周期能够处理更多的指令。但**流水级数的增加，需要将指令的操作步骤划分更细**。显然，指令执行步骤不可能随意细分。

提高流水线处理效率的另一个方法是**缩短机器周期**。一般是**将一个机器周期划分为若干个子周期**，**每个子周期均发射一条新的指令，亦即每个机器周期发射多条指令，从而提高计算机的性能**。这种处理方式称为**超流水线处理技术**。下图是8级超流水线处理过程的前4级执行进程。

![image-20210914135617945](https://i.loli.net/2021/09/14/YlSUiQejPgD6nrK.png)

图 8级超流水线处理过程的前4级执行过程



超流水线技术对芯片的工作速度要求比较高，同时硬件系统比较复杂，需要占用较大的芯片的面积，因此**超流水线结构在嵌入式RISC处理器中很少采用**。

在工艺水平允许的条件下，**流水线深度**主要受**数据相关、资源竞争及转移指令**（主要是**条件转移指令**）等因素的制约。这些因素将使流水线中断，从而影响指令执行的速度。

- 数据相关可通过增加算术逻辑单元或在逻辑上加以改进即可解决。

- 资源竞争可以通过增加写入写出暂存器解决。

- 对由条件转移指令打断流水线的解决方法比较复杂。目前通用高档RISC微处理器都采用**转移预测**的方法，但实现这些预测的算法需要很多硬件，这在嵌入式RISC处理器领域由于硬件资源的限制而不宜采用。


因此，在嵌入式RISC处理器中，流水线级数目前多采用4～5级。即使是条件转移指令，由于没有转移预测的逻辑功能，遇到条件转移时，流水线有可能中断，但中断时间不会超过1～2个时钟，对整个系统不会造成什么影响。目前为了减少条件转移指令对微处理器的影响，都借助优化编译器，在条件转移指令之后放一条后面必定要执行的指令，以填补转移指令条件判断时的这段空档，而不影响流水线的畅通。

### 2．超标量处理技术

根据计算机对**操作数处理**的情况，可以将计算机分为**标量机**和**向量机**。

* 普通的处理器**一次发射一条指令**，**每条指令只能处理一个操作数或一对操作数**，这种处理方式称为**标量处理**，相应的计算机就是**标量机**。
* 向量机的**一条指令可以处理n个操作数或n对操作数**，当然，向量机**需要n个功能部件以同时对n个或n对操作数进行并行处理**。向量机所执行的程序与标量机不同，**是向量化程序**。

超标量处理同标量处理一样，**执行非向量化**，但又像向量机那样，可以**处理多个操作数**。超标量处理都**采用流水线操作方式，一次发射多条指令，**下图是采用4级流水线的超标量处理的指令执行过程。当各条硬件流水线都充满后，每个机器周期等效完成两条指令。当然，**超标量处理必须增加处理器的硬件规模。**目前，**高档的RISC处理器已可以同时发射四条以上的指令**，大大提高了微处理器的性能。

<img src="https://i.loli.net/2021/09/14/mhkbBOHnDlKRoJI.png" alt="image-20210914140628271" style="zoom:67%;" />

图 超标量并行技术指令执行过程



与传统的处理器不同，超标量处理器的显著特点就是**具有多个彼此独立的执行部件，或者具有多条执行流水线**。**在处理器中适当增加执行部件的个数**，会获得明显的性能增益。执行部件的设置主要根据**各种指令在程序中的使用频度**来考虑。

对大量应用程序的统计分析表明：

* **整数运算和逻辑运算指令**为运行指令总数的40%～50%
* **装入/存储指令**占10%以上；
* **转移指令**占10%～20%，有时达到30%，
* 此外，还经常会有**浮点运算**。

因此，微处理器的设计中，总是把**整数运算部件、浮点运算部件、装入/存储部件和转移部件**作为首要的执行部件，而且，都把**整数运算部件设置为2～3个**，以满足程序运行的需要。

此外，还可以根据微处理器的应用领域设置相应的执行部件。近年来，对图形和图象数据的数字处理需求急剧增长，因此，在一些新开发的微处理器产品中，设置了专门的图形处理部件，从而大大提高了图象信号处理的能力。
**在SOC中，如果处理器的执行部件除了整数运算部件之外，还有浮点运算单元，或者具有DSP功能硬件时，采用多指令发射的超标量处理技术是适宜的。**

### 3．VLIW处理技术

VLIW是超长指令字（Very Long Instruction Word）的英文缩写。VLIW结构计算机设计思想是美国Yale大学的Fisher教授于1983年提出的。其基本结构如下图所示。VLIW结构的主要特点是：

<img src="https://i.loli.net/2021/09/14/u7gMbirZt69So1H.png" alt="image-20210914141811643" style="zoom:50%;" />

图 VLIW的基本结构

* 相当长的机器指令字。VLIW处理器的指令字长可高达几百比特，而且指令所包含的字段是全正交的，彼此互不相关，故可控制多个功能部件。

* 多执行部件。和超标量处理器一样，VLIW处理器具有多个独立的执行部件，这些执行部件既可以是同类的，也可以是异类的。因此处理器可以同时执行若干独立的操作，诸如整数和浮点运算、转移控制、存储器访问以及数据传输等。

VLIW处理器虽然每个周期执行多个操作，但实质上仍是**SIMD（单指令流多数据流）处理器**。同其他RISC处理器相比，VLIW处理器主要有两个优点。

第一，VLIW结构高度规则化，指令的执行不会产生副作用，对VLIW处理器资源的访问几乎不会带来相关问题。因此，对其操作的调度可以在相当大的自由度下进行，允许编译器采用大量可行的优化技术。

第二，处理器指令的作用，包括每条指令的定时，都是严格确定的。整个处理器在全局时钟的支配下，同步地执行操作。因此编译器可在程序执行时准确地预测到大量关于运行的信息，使得编译器能够在编译时便解决各种数据相关和资源相关问题，从而有效地调度并行操作，而不必在运行时根据出现的问题再采取措施。然而，当程序运行时的可预测性降低时，其性能也将随之很快地降低。

除此之外，VLIW处理器的指令系统不仅是体系结构的一个属性，而且又成为实现的一个重要组成部分。VLIW的指令系统，包括指令字长、指令格式、指令字段定义以及指令操作等，与处理器的结构紧密相联。这就难以在不同处理器之间实现软件兼容。因此，自VLIW设计思想提出以来，在通用计算机中应用较少。但是，VLIW适合于数字处理和图象信号处理等领域。在SOC中，往往存在多个功能部件，采用VLIW技术是合适的。

## 5 RISC/DSP结构

**RISC微处理器是通用处理器结构，DSP适合于数字信号处理的运算。**在数字信号处理中，最基本的运算是离散卷积，其基本的运算形式为

<img src="https://i.loli.net/2021/09/14/hzRpsBIrHU1gbfO.png" alt="image-20210914142327546" style="zoom:67%;" />

式中x（n-i）是激励信号序列，h（i）是系数，它的选取与具体的算法有关，y（n）是响应。上式的基本操作是乘法和累加，以及延迟。

为了适合于数字信号的处理，DSP的结构专门设计成能够高效地执行数字信号处理的各种基本操作。**在DSP中**，广泛采用**流水线操作和哈佛结构**，具有专门的**硬件乘法器和特殊的DSP指令**，主要是单周期的累加乘指令和单周期延迟指令。目前，通用DSP的产品很多，典型的产品是TI的TMS320系列。从20世纪80年代初推出第一代产品以来，TI已开发生产了六代产品，五十几个品种，是世界上使用最广的通用DSP产品。

在面向数字信号处理或者高速数据处理应用的SOC中，往往**将RISC处理器和DSP组合在一个芯片上，构成RISC/DSP结构**。这种结构有两种形式。

* 一种是将独立的RISC处理器与独立的DSP集成在一个芯片上。如图（a）所示，**两者的指令流和数据流分开**。

* 另一种形式是将DSP按照RISC原则进行重新设计，使**两者的指令流甚至数据流全部统一**。在图（b）的方式中，DSP功能块自身产生数据地址，但DSP与RISC处理器的指令流是统一的。在图（c）的方式中，DSP和RISC处理器不仅指令流统一，而且数据地址也由RISC核产生。

RISC/DSP结构具有很好的发展前景，其中DSP部分的功能可根据不同的应用场合确定，同时保留一定的功能灵活性。

![image-20210914142654248](https://i.loli.net/2021/09/14/8yUQGrKY73u59h2.png)


图 RISC/DSP结构

TMS320C8X是TI于1995年推出的采用RISC/DSP结构的多处理器数字信号处理器芯片。在TMS320C80上集成了4个可并行处理的高性能DSP，一个RISC处理器、一个传输控制器、一个视频控制器和50K字节的高速SRAM，构成一个高性能的集成系统芯片。RISC MP的性能和DSP0～DSP3的高速并行运算的完美结合，使得TMS320C80具有强大的功能，每秒可执行20亿次类似RISC处理器的操作（2BOPs），可实时实现新一代的视频压缩和解压，广泛应用于会议电视、可视电话、图像和视频信号处理、二维和三维图形加速、雷达和声纳信号处理等场合。
TMS320C80的结构如下图所示。

<img src="https://i.loli.net/2021/09/14/pmXtxSL5QfyDKFA.png" alt="image-20210914142925761" style="zoom:67%;" />

图 TMS320C80的结构图

TMS320C80的主要特点是：

1．多处理器结构

TMS320C80内部集成了五个处理器，四个DSP和一个主处理器MP。这些处理器可实现**多指令、多数据（Multiple-Instruction Multiple-Data, MIMD）操作**，相互之间通过**纵横开关（crosbar）网络**和**片内RAM**互连，从而可以共享片上资源，并提高操作速度。

2．并行DSP

TMS320C80上集成了4个高性能的DSP，这4个DSP既可独立运行，也可并行工作，采用VILW技术，指令字长64位，可以在单个周期内执行多个操作。每个处理器具有专用的高速指令缓存和专用的数据RAM。

每个DSP具有**4个主要功能单元，即1个程序控制器、1个数据单元和2个地址单元**。

* 程序控制器处理所有的指令执行。
* 数据单元可执行单周期乘法操作，并可使乘法以及算术逻辑单元（ALU）的数据处理操作并行执行。32位的ALU可以分解为2个16位ALU或4个8位的ALU，以便对低精度的数据进行更多的并行操作。同时，数据单元中包括对数据单元寄存器、乘法器路径和ALU路径的指定，从而确定进行运算的一个操作数。
* 两个地址单元：局部地址单元（Local）和全局地址单元（Global），两者的结构几乎是一样的，用以对两个存储单元独立地进行取数和存储操作。

3．RISC主处理器

RISC**主处理器对芯片上所有部件进行管理**，并**协调系统内处理器之间的通信**。

这个RISC处理器字长32位，**内部**有一个运算能力为100M FLOPS并附合IEEE-754标准的**浮点运算单元（FPU）**，指令字长32位，并具有31个32位的寄存器。该运算单元可以实现32位的单精度或64位双精度浮点运算。

4．传输控制器

传输控制器的作用相当于**智能DMA控制器**，使TMS320C80可以以每秒400M字节的速度与外部交换数据。传输控制器可对二维图形进行线性寻址和二维寻址，支持三维图形缓冲。

传输控制器提供了多种存储器的操作，包括DRAM, SDRAM, VRAM和SRAM，此外支持8至64位数据传输。灵活的总线宽度可以适合各种不同的应用，而无需专用的接口。

5．存储器Crossbar结构

TMS320C80内的处理器通过**纵横开关网络Crossbar**与片内50K字节的SRAM进行数据交换，使片内处理器可共享片内RAM。Crossbar在每个时钟周期内可进行5次取指和10次并行数据访问，传输速率达每秒4.2G字节。优先权控制逻辑保证每次仅有一个处理器访问RAM。

6．视频控制器VC

视频控制器具有2个可编程的帧定时器，可按水平或垂直格式同时捕获和显示图像。帧定时器是软件可编程的，可用于任何捕获/显示的组合中，对不同速率的图像捕获可按异步方式工作，帧定时器还可以用作通用定时器。
图6-9中的一些部件的名称所代表的含义如下：

 I   指令端口。DSP的指令端口为64位，MP的指令端口为32位。       

L   DSP的局部地址单元地址总线。       

G   DSP的全局地址单元地址总线。       

C/D高速缓存RAM/数据RAM地址。       

TAP IEEE1149.1测试口。

## 6 RlSC核的设计

大多数系统集成芯片的**主处理器（Main Processor, MP）是嵌入式RISC核**，RISC核主要完成**系统的控制功能**，**管理和协调系统内各子系统的通信和操作**，同时也可承担一定的**算法任务**。为了使RISC核设计易于修改，以适应不同的应用，便于扩展新的指令和对系统芯片体系结构的研究，在RISC核的设计中应遵循下述原则：

（1）模块化：若需加入新的指令，只需要修改相关的部分，系统结构不应变化。
（2）可扩展性：所有的数据结构和接口应能方便加入新的模块。
（3）可综合性：处理器核的描述应该能够综合，以得到实际电路的实现。
（4）可测试性：处理器核的设计应该便于进行系统测试和性能分析。
（5）分布性：**处理器的控制**设计成分布式控制，便于指令集扩展和处理器适应新的应用要求。**分布式控制**主要负责**流水级管理和每个流水级之间的状态通信**。

下图是根据上述原则设计的一种嵌入式RISC核，这个RISC核分为三层：

* 第一层为顶层；
* 第二层包括六个模块，分别是**整数单元、高速缓存、乘法/除单元、异常处理和TLB、总线控制和寄存器文件**；
* 第三层主要包括**总线控制模块的子模块**（DMA控制、SDRAM控制、存储器控制和I/O控制）、**整数单元的子模块**（取指控制部件IF、译码部件ID、执行控制部件EXE、存储控制逻辑MEM和回写控制逻辑WB,5级流水）、**高速缓存的子模块**（指令高缓、数据高缓和FIFO）以及**乘除模块的子模块**（乘法部件和除法部件）。

这种层次结构设计特别有利于综合。**对系统设计的修改只需修改相应的子模块**，例如，对于指令的扩展，只需修改整数单元中的相应的子模块ID、EXE和MEM即可。

![image-20210914144533542](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20210914144533542.png)

图  一种嵌入式RISC核的设计

