# 系统集成芯片（SOC）的结构

## 1 引言

系统集成芯片SOC以电子系统的系统功能为出发点，把系统模型、处理机制、芯片结构、各层次电路直至器件的设计紧密结合起来，在单片或若干芯片上完成整个系统的功能。**系统功能集成**是SOC的核心技术。在使用SOC技术的应用系统时，就是要把整个应用电子系统集成在一片（或若干片）芯片上。

SOC**不是以功能电路为基础**的分布式系统的综合技术，而是**以功能IP核为基础**的**系统模块和电路综合**的技术。

**IP核是SOC应用的基础。嵌入式系统是SOC的基本结构**。所谓嵌入式系统是计算机应用的一种方式。**在嵌入式系统中，计算机硬件和软件结合在一起，构成一个专门的计算装置**，这种计算装置设有普通计算机所提供的那些许多便利的用户接口和软件工具，一般不能进行用户再编程。

嵌入式系统中软件的开发是通过交叉开发来完成的，即开发环境和实时运行环境是不同的。嵌入式系统工作在与外界发生交互并受到时间约束的环境中，在没有人工干预的情况下进行实时运行。因此，嵌入式系统不再具有普通计算机的形态和功能，是一个大系统或大的电子设备的一部分。

嵌入式系统通常具有如下特点：

（1）完成单一或一组紧密相关的特定功能；
（2）系统作为整个设备的一部分，其运行一般不需要人工干预；
（3）具有**高性能和实时处理**的要求；
（4）具有良好的电磁兼容性。

SOC以嵌入式系统为核心，集软、硬件于一体，并追求产品系统最大包容的集成，是微电子领域IC设计的必然趋势和最终目标，也是现代电子系统设计开发的最佳选择。

**SOC是一种系统级集成芯片，其系统功能可以由全硬件电路完成，也可以由硬件和软件协同完成。**

## 2 系统集成芯片（SOC）的硬件结构

**系统的功能**可以归结成**算法来表示**，**芯片的结构**是**算法的实现**。

根据不同的应用目的，目前，系统集成芯片可分为两种类型：

* 一种是**专用的SOC芯片**，这类芯片是**专用集成电路ASIC**（Application Specific Integrate Circuits）向**系统级集成**的自然发展。
* 另一类是**通用类型的SOC芯片**，在这类SOC上，将绝大部分部件，如RISC处理器，DSP、RAM、接口电路等集成在芯片上，同时提供用户设计所需要的可编程逻辑资源和软件编程所需的资源。下图是一种通用类型的SOC结构图。

<img src="https://i.loli.net/2021/09/08/3C7DE1m6dpTFo8j.png" alt="image-20210908101117303" style="zoom:50%;" />

<center>通用类型的SOC结构图</center>

无论是专用SOC还是通用SOC，它们在结构上都有相似的特点，都是以嵌入式系统结构为基础，集软、硬件于一体的系统级芯片。

系统集成芯片的硬件主要有下列部分构成：

### 专用硬件

专用硬件是为某种专门应用的算法或功能设计的部件。由于是专门优化设计的，采用专用硬件容易得到高速高效的应用效果。一般，**对于方法比较特殊而又速度要求较高的功能模块，都可以考虑采用专用硬件**。

通常，**除制成ASIC外，专用硬件还可以由可编程逻辑资源实现。**

### 嵌入式处理器

在SOC中，往往集成了**一个或若干个处理器**，包括**RISC处理器、DSP**以及为某些专门应用设计的**专用指令集处理器（Application Specific Instruction Set Processor）**。

这些处理器是SOC的一个组成部分，和SOC的其他部件融合在一起，构成一个完整的系统，因此，**将SOC上的处理器称为嵌入式处理器**。通常，**把所有处理器统称为指令集构造部件ISA**（Instruction Set Architecture, ISA）。ISA是可编程的，灵活性大，系统功能的改善和升级都比较方便。

在SOC中，系统的控制任务通常由RISC CPU担任。RISC是精简指令集计算机Reduced Instruction Set Computer的英文缩写，是20世纪70年代年代提出的计算机系统结构设计的一种新的思路。

长期以来，计算机系统结构的主流是复杂指令集计算机（Complex Instruction Set Computer, CISC）。在CISC设计中，以缩小计算机硬件与软件之间的语义空隙为目标，通过增加一类在语义上更接近于高级语言的指令的办法，构造一个指令集更易于编程的计算机，以期减少软件成本。CISC具有如下显著特点：

（1）指令格式不固定，指令长度不一致，操作数可多可少；
（2）寻址方式复杂多样，以利于程序的编写；
（3）采用微程序结构，执行每条指令均需完成一个微指令序列；
（4）每条指令需要若干个机器周期才能完成，指令越复杂，花费的机器周期越多。

在过去几十年里，CISC一直占据着计算机结构的绝对主导地位，几乎所有计算机都是CISC结构。然而，随着微电子技术和计算机技术的发展，越来越复杂的CISC日益暴露出一些难以克服的缺点。

第一，CISC所包含的为数众多的指令，其使用频度并不平衡。

大量程序运行的统计表明，**常用的指令是诸如传递、比较、转移、循环和加法等操作比较简单的指令，这类指令仅占CISC指令集的20%左右**。

一些操作极其复杂的指令，尽管花费了大量的机器执行时间，占用了宝贵的芯片面积，以保存这些指令的微程序，但这些指令的使用频度极低。因此，**用硬件实现这些指令有时并非必要**。

第二，微指令的结构限制了CISC CPU速度的进一步提高。

在20世纪80年代以前，由于当时微电子技术发展水平的限制，**存放微指令的控存**和**存放程序的主存**的工作速度差距较大，前者比后者快5～10倍，因此，将一条指令分成若干个微周期（机器周期）执行，以使若干个**微周期**与一个**主存周期**相匹配，这种安排对提高处理器的性能是有利的，但是，随着微电子技术的发展，**半导体存储器的工作速度成倍提高，高速缓存（Cache）普遍应用。控存与主存（包括高速缓存）的速度差距明显缩小，一个微指令周期与机器周期已非常接近**。采用微程序方法，即使最简单的指令也需花费几个机器周期才能完成，这就限制了计算机工作速度的提高。

第三，CISC结构**不利于并行处理**方法。

**提高计算机速度**的一个主要途径是**实现指令级并行处理**，目前广泛采用了**流水线操作和超标量处理**等先进技术。由于CISC指令结构复杂，格式不固定，长度不相同，使得上述技术难以在CISC上应用，即使在CISC上采用流水线技术，其结构也相当复杂，效率也不尽如人意。

鉴于CISC结构的上述弊端，促进了RISC的研究和发展，近年来，出现了一些性能优异的RISC处理器产品，并已实用。

SOC**具有确定的应用背景，其中的处理器所承担的任务是单一的、明确的**。因此，无论从硬件资源的利用，还是从处理器所承担的任务考虑，在SOC中采用RISC处理器是适宜的。

### 片上RAM和ROM

片上RAM是SOC必需的组成部分，**为了满足SOC对数据高速处理的需要，有些芯片上存储器甚至占了资源的一半以上**。

SOC的**ROM通常是EPROM或E2PROM，主要供固化应用软件使用**。即使是全专用硬件构成的SOC，也应设计成具有**状态寄存器**，及相应的服务程序，以便在调试过程中能够被检查、被写入，以控制芯片的工作。

### 测试电路

SOC芯片的设计应满足可测试性的要求，为此，**芯片上应当具有传送测试信号所必需的接口电路**，以及支持芯片测试功能所必需的控制逻辑。

在SOC的设计中，应当充分利用各种IP核资源，以缩短应用系统的开发周期。

## 3 嵌入式软件

SOC的**应用软件以固化形式存入片上存储器中**，是一种嵌入式软件。一般，SOC芯片上的存储器容量较小，所以对应用软件有比较严格的要求。在SOC中运行的应用软件应容积小、实时性强。

为了片上主控RISC处理器所需并行和并发进程的调度、中断处理、输入输出作业以及片上多个部件并行工作，**有些SOC需要嵌入式实时操作系统（Real Time Operational System, RTOS）的支持**。

**嵌入式实时操作系统**是**计算机操作系统的技术和设计理念在嵌入式系统中的应用**。

操作系统是计算机系统中最基本、最主要的软件，操作系统管理着计算机的资源，包括硬件资源和软件资源，并提供开发应用程序的基础。计算机操作系统面向用户，为用户提供了良好的人机界面。经过几十年的发展，计算机操作系统功能强大、性能完善，是世界上无数优秀的计算机专家们数十年智慧的结晶，为有效地使用计算机和普及计算机的应用起到了巨大的作用。

**计算机操作系统**的工作方式是**分时制**，**系统软件相当庞大**。**嵌入式系统**是**实时系统**，**系统对外部事件的响应和处理有严格的时间要求**。此外，**嵌入式系统的存储器容量较小**，因此，试图将计算机操作系统直接应用到嵌入式系统并不适宜。然而，在计算机操作系统的基础上，根据嵌入式系统的特点，保留其精华，舍弃一部分不必要的功能，以形成**短小精悍的实时操作系统，对于提高SOC的系统功能是十分重要的**。

**嵌入式实时操作系统中，没有计算操作系统中庞大的文件管理和内存管理的内容，**它所具有的是实时操作系统中最为重要的内容，即**多任务实时调度和任务的定时、同步操作**。**在任意时刻，处于运行状态的任务只有一个**，其他任务则处于另外的状态，如睡眠、等待、就绪等。

嵌入式实时操作系统是服务于嵌入式应用产品的开发人员的。嵌入式实时操作系统的精华在于**向开发人员提供一个实时多任务内核**。开发人员应将项目分解成若干独立的任务，将各任务承担的功能、任务间转换的关系向实时多任务内核交代清楚，让**实时多任务内核去管理这些任务**，开发进程即告完成。

综上所述可见，在SOC中嵌入实时操作系统RTOS，对于缩短产品开发周期，提高系统的产量是十分有利的。**在SOC中，RTOS并非全部是软件，其部分功能也可以用硬件实现，以满足高速运行的需要。**

