软件



[(5条消息) 进程、线程、堆、栈的关系_chablin的博客-CSDN博客](https://blog.csdn.net/chablin/article/details/79828559?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-0.no_search_link&spm=1001.2101.3001.4242)

## 一个进程中各线程的堆和栈的关系

在很多现代操作系统中，一个**进程的（虚）地址空间**大小为4G，分为**系统空间**和**用户空间**两部分：

* **系统空间为所有进程共享**。
* **用户空间是独立的**，一般Windows进程的用户空间为2G。

 **一个进程中的所有线程**共享该进程的地址空间，但它们**有各自独立的（私有的）栈(stack)**，Windows线程的缺省堆栈大小为1M。

**堆(heap)**的分配与栈有所不同，一般是**一个进程有一个C运行时堆**，**这个堆为本进程中所有线程共享**，Windows进程还有所谓**进程默认堆**，用户也可以创建自己的堆。



堆：是**大家共有的空间**，分**全局堆和局部堆**。

- 全局堆就是**所有没有分配的空间**。
- 局部堆就是**用户分配的空间**。

堆在**操作系统对进程初始化的时候分配**，运行过程中也可以向系统要额外的堆，但是记得用完了要还给操作系统，要不然就是**内存泄漏**。



栈：是个**线程独有的**，**保存其运行状态和局部自动变量的**。栈在线程开始的时候初始化，每个线程的栈互相独立，因此，栈是thread safe的。每个Ｃ＋＋对象的数据成员也存在在栈中，**每个函数都有自己的栈**，**栈被用来在函数之间传递参数**。操作系统在切换线程的时候会自动的切换栈，就是切换SS/ESP寄存器。栈空间不需要在高级语言里面显式的分配和释放。





**一、预备知识—程序的内存分配**

一个由C/C++编译的程序**占用的内存**分为以下几个部分：

1、栈区（stack）：由编译器自动分配释放，**存放函数的参数值，局部变量的值**等。其操作方式类似于数据结构中的栈。

2、堆区（heap）： **一般由程序员分配释放，若程序员不释放，程序结束时可能由OS回收**。注意它与数据结构中的堆是两回事，分配方式倒是类似于链表。

3、全局区（静态区）（static）：全局变量和静态变量的存储是放在一块的，初始化的全局变量和静态变量在一块区域，未初始化的全局变量和未初始化的静态变量在相邻的另一块区域。程序结束后由系统释放。

4、文字常量区：常量字符串就是放在这里的。程序结束后由系统释放。

5、程序代码区：存放函数体的二进制代码。



## 进程线程及堆栈关系的总结

突然想到进程的栈和线程的栈,就顺便说一下,线程的栈被自动分配到进程的内存空间中

进程和线程都是由操作系统所体会的程序运行的基本单元，系统利用该基本单元实现系统对应用的并发性。进程和线程的区别在于： 

简而言之，**一个程序至少有一个进程,一个进程至少有一个线程**。

线程的划分尺度小于进程，使得多线程程序的**并发性高**。 

另外，进程在执行过程中拥有独立的内存单元，而多个线程共享内存，从而极大地提高了程序的运行效率。 

线程在执行过程中与进程还是有区别的。每个独立的线程有一个程序运行的入口、顺序执行序列和程序的出口。但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制。 

从逻辑角度来看，**多线程的意义在于一个应用程序中，有多个执行部分可以同时执行。但操作系统并没有将多个线程看做多个独立的应用，来实现进程的调度和管理以及资源分配**。这就是进程和线程的重要区别。 

进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动,进程是系统进行资源分配和调度的一个独立单位. 

线程是进程的一个实体,是CPU调度和分派的基本单位,它是比进程更小的能独立运行的基本单位.线程自己基本上不拥有系统资源,只拥有一点在运行中必不可少的资源(如程序计数器,一组寄存器和栈),但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源. 

一个线程可以创建和撤销另一个线程;同一个进程中的多个线程之间可以并发执行.



# 操作系统的内存对齐



## 进程、线程、函数、栈的关系

进程：是没用栈的概念的。进程其实就是一个用于盛放资源的容器。

线程：线程的一级表达就是栈，具体实现时，是**一个线程对应一个栈（足够大）**。**属于同一线程的函数共用这个线程栈**，在上面开辟自己的空间。

函数：使用一部分线程来完成执行。

栈：**只在线程中有其具体定义和表述**，从某种意义上讲，**栈可以代表一个线程**。

