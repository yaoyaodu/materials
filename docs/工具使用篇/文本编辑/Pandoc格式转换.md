# Pandoc格式转换

[利用pandoc将markdown转换为word文档 - kofyou - 博客园 (cnblogs.com)](https://www.cnblogs.com/kofyou/p/14932700.html)（详细、实用）

[Pandoc 实用教程](https://blog.csdn.net/fenghuizhidao/article/details/107202497)

pandoc官网：https://www.pandoc.org/

pandoc手册：https://www.pandoc.org/MANUAL.html

https://github.com/jgm/pandoc （git clone https://github.com/jgm/pandoc.git）

https://www.pandoc.org/installing.html

Pandoc是用于**将文件从一种标记语言转换为另一种标记语言的命令行工具**。 标记语言使用标签来注释文档的各个部分。 常用的标记语言包括Markdown，ReStructuredText，HTML，LaTex，ePub和Microsoft Word docx。

用简单的英语， Pandoc允许您将一堆文件从一种标记语言转换成另一种标记语言。 典型示例包括将Markdown文件转换为Word, PPT，LaTeX，PDF甚至是ePub。

Pandoc是一个软件，是一个能把千奇百怪的文档格式互相转换的神器，是一把文档转换的瑞士军刀（swiss-army knife）。

## 安装Pandoc

Pandoc载链接见[github](https://github.com/jgm/pandoc/releases)。

pandoc安装：双击安装，打开命令行输入 pandoc -v 看是否安装成功。

## Linux环境中安装Pandoc

sudo apt-get install pandoc (这样就够用了)

不够用的话参考：[Linux环境下安装pandoc](https://blog.csdn.net/weixin_44375591/article/details/104005570)

## 命令行运行基本参数

- 使用参数`-f` `FORMAT`和`-t` `FORMAT`指定源和目标文件格式。**pandoc支持识别文档后缀，一般可以省略。**
- 使用参数`-o` `FILE`指定输出文件。

命令示例：pandoc filename.md -o filename.docx

## HTML转RST

命令：`pandoc D:\pandoc\DNN.html -o D:\pandoc\DNN.rst`

进行转换前，可先对HTML文件进行处理。

1. 用Chrome打开网页，右击页面选择“检查”。
2. 找到`<body></body>`标签。双击此标签展开此标签。
3. 找到`<div id="site-content">...</div>`标签。击此标签展开此标签。
4. 找到`<div id="contents-container">...</div>`标签。
5. 找到`<article id="contents">...</article>`标签。向上拖动该标签至`<head></head>`标签之上。
6. 删除`<head></head>`和`<body></body>`标签。
7. 右击网页选择“另存为”。这样整理之后，导航栏等无用的内容都清除了，只剩下正文内容。

## RST转Word

命令：`pandoc D:\pandoc\mcfft.rst -o D:\pandoc\mcfft.docx`

## Word转RST

命令：`pandoc D:\pandoc\mcfft.docx -o D:\pandoc\mcfft.rst`

## RST转PDF（有点麻烦）

需安装pdflatex

命令：`pandoc D:\pandoc\mcfft.rst -o D:\pandoc\mcfft.pdf`

```
pandoc -t latex --pdf-engine=pdflatex -s -o index.pdf index.rst
```

## Markdown转Word

1. 打开**命令提示符**工具。
2. 输入`pandoc C:\Users\user\Desktop\文件名.md -o C:\Users\user\Desktop\输出文件名.docx`。

<img src="https://i.loli.net/2021/08/18/z1EyuFIkKTNsZOG.png" alt="image-20210818095750059" style="zoom: 50%;" />

## 导出 Word 文档设置

--toc 												# 生成目录

 --toc-depth=number  				# 生成的目录深度

 --wrap=auto|none|preserve 	# 文字换行方式 

--reference-doc=file 					# 指定输出模板

示例：`--reference-doc=C:\Users\user\Desktop\MarkdownToWordTemplate.docx`

示例：指定了输出模板、目录和目录层级。

pandoc C:\Users\user\Desktop\中文技术文档写作规范.md -o C:\Users\user\Desktop\中文技术文档写作规范.docx --reference-doc=C:\Users\user\Desktop\MarkdownToWordTemplate.docx --toc --toc-depth=1

（也可以将修改后的模板文件放置到 **Pandoc 的数据文件夹**下，并命名为 `reference.docx`，**后续 Pandoc 将把这个文件作为默认模板进行使用。**这里的数据文件夹，可以在 `pandoc -v` 指令的打印信息中，通过 `data-dir` 字段来获取。）

## 修改默认Word模板

1. 默认的 word 模板可以通过命令来查看：pandoc --print-default-data-file reference.docx > custom-reference.docx

2. 执行命令后，默认的模板（custom-reference.docx ）保存在当前目录下，你可以对各个文字样式、默认表格样式进行修改。

3. 如果要修改输出文件中的表格样式，直接给模板中的表格更换样式，不能达成效果。根据Github上的讨论得知，**必须修改名为Table的表格样式**。修改方法：

   1. 开始菜单—样式—右下方三角号—出现样式列表框。

   2. 点击最下方**管理样式**图标。弹出**管理样式**对话框。

   3. 编辑—Table（使用前隐藏）—修改。

      **说明：在样式列表框里找不到Table这个样式，是隐藏的。**



## 合并多个markdown文件，自动生成目录

pandoc可以接受多个文件为输入，例如`pandoc file1.md file2.md file3.md -o result.docx`。另外有一些参数可以用于自动生成目录。

1. 生成目录

   - 使用参数`--toc`自动生成目录

     同时可以修改格式参考文件中，`TOC标题`/`TOCHeader`的样式，选中`段前分页`，这样之后手动插入文档封面会比较方便。

   - 使用参数`--toc-depth=NUMBER`指定目录包含的标题深度

     如果每一篇markdown的文章标题都是一级标题，使用`--toc-depth=1`可以生成最简单的目录。

   - 使用参数`--reference-doc=FILE`指定格式参考文件，并给格式参考文件添加页码，如此生成的文件也会有页码。

2. 文件分页

   Pandoc读入了多个文件，输出时各个文件的内容是连续的。如果希望每个文件能从新的一页开始，检索互联网得到两种解决方式：

   - 格式选择段前分页

     一级标题往往是文章标题。如果修改一级标题的格式，选中`段前分页`，每一个markdown文件的一级标题就会出现在新的一页。

     ![img](https://i.loli.net/2021/08/26/AUbkVIyXdEHSj1m.png)

     参考链接：[How to add a page break in word document generated by RStudio & markdown](https://stackoverflow.com/a/39008120/15670192)

   - pandoc使用filter

     > Pandoc provides an interface for users to write programs (known as filters) which act on pandoc’s AST.

     什么是filter，参考官网：[Pandoc filters](https://pandoc.org/filters.html)

     如何使用filter达到分页目的，参考：[Pandoc markdown page break](https://stackoverflow.com/a/52131435/15670192)



### markdown预处理

提前处理markdown源文件，或者根据结果修改markdown文件，以得到排版较好的word文件。

1. 合理使用标题层次

   合并多篇markdown时，注意统一标题层次。

2. 合理使用markdown语法

   例如，避免仅仅为了排版美观而使用引用语法；markdown引用在word文件中显示效果不同，错误使用可能会产生奇怪的效果。

3. 注意缩进和空行

   使用缩进和空行以体现段落关系。观察下面两个结果：

   |                           markdwon                           |                             word                             |
   | :----------------------------------------------------------: | :----------------------------------------------------------: |
   | ![img](https://img2020.cnblogs.com/blog/1094802/202106/1094802-20210627185535159-469799297.png) | ![img](https://img2020.cnblogs.com/blog/1094802/202106/1094802-20210627185557494-188023789.png) |
   | ![img](https://img2020.cnblogs.com/blog/1094802/202106/1094802-20210627185613378-730680670.png) | ![img](https://img2020.cnblogs.com/blog/1094802/202106/1094802-20210627185628006-1421863747.png) |

4. 避免手动换行排版

   markdown中不要为了让每行文字数量相同而手动使用回车换行。

5. 替换html标签（暂时没有找到支持的方式）

   如果使用了html表格/图片等，需要替换成相应的markdown语法。



## 设置 metadata

metadata 是导出格式中的一些信息，例如作者、日期、简介等等，在 EPUB、**PDF、Word** 等格式中有一定作用。

- 在命令行中指定 metadata。

  -M KEY[=VAL], --metadata=KEY[:VAL] 		# 将 KEY 的内容设置为 VAL 

  --metadata-file=file 									 # 读取 file 中的内容作为 metadata

- 在文件中顶部对 metadata 进行声明，使用 YAML 语法。

  ---

  *# 该部分必须在文档的顶部* 

  *# 顶部和底部的 三个横线必须保留* 

  title: 标题 

  author: 

  `-作者 1` 

  `- 作者 2` 

  date: 日期 

  keywords: [关键词 1, 关键词 2] 

  abstract: |  

  ​     第一段   

  ​     第二段 

  ---



--metadata-file=C:\Users\user\Desktop\封面.md 不起作用



## Word转Markdown

1. 打开**命令提示符**工具。

2. 输入`pandoc C:\Users\user\Desktop\Datasheet.docx -o C:\Users\user\Desktop\Datasheet.md`。

问题：

- 格式会乱，目录，表格，封面
